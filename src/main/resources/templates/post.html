<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title} + ' | Blog'">Blog Post</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f8f9fa; }
        .container { max-width: 800px; margin-top: 20px; }
        h1 { color: #343a40; }
        .post-content { background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .comment { border-bottom: 1px solid #e9ecef; padding: 10px 0; }
        .comment-form { margin-top: 20px; }
        .error { color: red; font-size: 0.9em; }
        .delete-post-btn { margin-top: 20px; }
    </style>
    <script>
        function validateCommentForm() {
            const visitorName = document.getElementById('visitorName')?.value?.trim();
            const commentContent = document.getElementById('commentContent')?.value?.trim();
            console.log('Validating comment: visitorName =', visitorName, 'commentContent =', commentContent);
            if (!visitorName) {
                alert('Please enter your name.');
                document.getElementById('visitorName')?.focus();
                return false;
            }
            if (!commentContent) {
                alert('Please enter a comment.');
                document.getElementById('commentContent')?.focus();
                return false;
            }
            return true;
        }
        document.addEventListener('DOMContentLoaded', function() {
            const comments = document.querySelectorAll('.comment');
            comments.forEach(comment => {
                const content = comment.querySelector('.comment-content')?.textContent;
                if (content && typeof content === 'string') {
                    console.log('Comment content starts with:', content.startsWith('Test') ? 'Test' : 'Other');
                }
            });
        });
    </script>
</head>
<body>
<div class="container">
    <a href="/api/posts" class="btn btn-secondary mb-3">Home</a>
    <h1 th:text="${post.title}">Title</h1>
    <div class="post-content">
        <p><strong>Author:</strong> <span th:text="${post.author?.fullName ?: 'Unknown'}">Unknown</span></p>
        <p th:text="${post.content}">Content</p>
    </div>
    <h3 th:text="'Comments (' + ${post.comments?.size() ?: 0} + ')'">Comments (0)</h3>
    <div th:if="${post.comments == null or post.comments.isEmpty()}">
        <p>No comments yet. Be the first to comment!</p>
    </div>
    <div th:unless="${post.comments == null or post.comments.isEmpty()}">
        <div class="comment" th:each="comment : ${post.comments}">
            <p><strong th:text="${comment.visitor?.fullname ?: 'Anonymous'}">Anonymous</strong></p>
            <p class="comment-content" th:text="${comment.content}">Comment Content</p>
        </div>
    </div>
    <div class="comment-form">
        <h4>Add a Comment</h4>
        <form th:action="@{/api/posts/{id}/comments(id=${post.id})}" th:object="${comments}" method="post" onsubmit="return validateCommentForm()">
            <div class="form-group mb-3">
                <label for="visitorName">Your Name:</label>
                <input type="text" id="visitorName" name="visitorName" class="form-control" placeholder="Enter your name" required />
                <div th:if="${visitorError}" th:text="${visitorError}" class="error"></div>
            </div>
            <div class="form-group mb-3">
                <label for="commentContent">Comment</label>
                <textarea th:field="*{content}" id="commentContent" class="form-control" placeholder="Enter your comment" required></textarea>
                <div th:if="${#fields.hasErrors('content')}" th:errors="*{content}" class="error"></div>
            </div>
            <button type="submit" class="btn btn-primary">Add Comment</button>
        </form>
    </div>
    <a th:href="@{/api/posts/{id}/delete(id=${post.id})}" class="btn btn-danger delete-post-btn">Delete Post</a>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>